<!DOCTYPE html>
<html lang="pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ministra√ß√£o - Ramo Juatuba</title>
    <style>
        :root { 
            --primary: #1a2a40; /* Azul Marinho Institucional */
            --secondary: #b8860b; /* Dourado */
            --bg: #fdfdfb; 
        }
        body { font-family: 'Segoe UI', Tahoma, Geneva, sans-serif; background: var(--bg); color: #333; display: flex; flex-direction: column; align-items: center; padding: 15px; margin: 0; }
        .card { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); width: 100%; max-width: 500px; margin-bottom: 20px; border-top: 4px solid var(--primary); box-sizing: border-box; }
        
        .header { text-align: center; margin: 20px 0; max-width: 500px; }
        .header h1 { color: var(--primary); margin: 0; font-size: 1.2em; text-transform: uppercase; line-height: 1.3; }
        .header p { color: var(--secondary); font-weight: bold; margin: 5px 0 0 0; font-size: 0.9em; letter-spacing: 1px; }
        
        .sync-area { background: #f4f7f9; padding: 15px; border-radius: 10px; margin-bottom: 20px; border: 1px dashed #ced4da; }
        input { width: 100%; padding: 12px; margin-bottom: 10px; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 14px; }
        
        .btn { padding: 12px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; width: 100%; transition: 0.2s; font-size: 14px; }
        .btn-sync { background: var(--primary); color: white; }
        .btn-p { background: #25D366; color: white; flex: 1; }
        .btn-f { background: #f8f9fa; color: #333; border: 1px solid #ddd; flex: 1; }
        
        .membro-item { padding: 15px; border-bottom: 1px solid #eee; display: flex; justify-content: space-between; align-items: center; background: white; }
        .membro-nome { font-weight: 600; color: #2c3e50; font-size: 15px; display: block; }
        .membro-nota { font-size: 0.8em; color: var(--secondary); font-style: italic; }

        #modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); justify-content: center; align-items: center; z-index: 1000; padding: 15px; box-sizing: border-box; }
        .modal-content { background: white; padding: 20px; border-radius: 15px; width: 100%; max-width: 400px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); }
        .sugestao-card { background: #f9f9f9; padding: 12px; border-radius: 10px; margin-top: 10px; cursor: pointer; border: 1px solid #eee; font-size: 0.95em; line-height: 1.4; color: #444; }
        .sugestao-card:hover { border-color: var(--secondary); background: #fffcf5; }
    </style>
</head>
<body>

    <div class="header">
        <h1>A Igreja de Jesus Cristo dos Santos dos √öltimos Dias</h1>
        <p>Ramo Juatuba</p>
    </div>

    <div class="card">
        <div class="sync-area">
            <small style="display:block; margin-bottom:5px; color:#555;">Sincronizar Lista (Google Sheets CSV):</small>
            <input type="text" id="csvUrl" placeholder="Cole o link da planilha p√∫blica aqui">
            <button class="btn btn-sync" onclick="importarDoGoogle()">üîÑ Atualizar Lista de Membros</button>
        </div>
        
        <div id="listaMembros">
            <p style='text-align:center; color:#999;'>Aguardando sincroniza√ß√£o da lista...</p>
        </div>
    </div>

    <div id="modal">
        <div class="modal-content">
            <h3 style="color:var(--primary); margin: 0 0 10px 0; font-size: 1.1em;">Mensagem de Apoio ‚ú®</h3>
            <div id="opcoesMensagens"></div>
            <button class="btn" style="background:#f1f1f1; margin-top:15px; color: #555;" onclick="fecharModal()">Voltar</button>
        </div>
    </div>

<script>
    let membros = JSON.parse(localStorage.getItem('membrosJuatuba')) || [];

    const biblioteca = {
        presenca: [
            "Ol√°, {nome}! ‚ú®%0A%0AFicamos muito felizes com a tua presen√ßa hoje no Ramo Juatuba. üå±%0A%0AQue o esp√≠rito desta reuni√£o te acompanhe durante toda a semana!{nota}",
            "Oi, {nome}! üôå%0A%0A Tua presen√ßa trouxe uma alegria especial para n√≥s hoje. Obrigado por partilhares o teu tempo e testemunho connosco. ‚ù§Ô∏è{nota}"
        ],
        falta: [
            "Ol√°, {nome}... ‚ù§Ô∏è%0A%0ASentimos a tua falta hoje no Ramo. Teu lugar e tua companhia s√£o muito importantes para n√≥s! ‚ú®%0A%0AEsperamos ver-te em breve.{nota}",
            "Oi, {nome}! üå±%0A%0APassando para dizer que nos lembramos de ti hoje com muito carinho. Esperamos que esteja tudo bem! üôè{nota}"
        ]
    };

    async function importarDoGoogle() {
        const url = document.getElementById('csvUrl').value;
        if(!url) return alert("Por favor, cole o link do CSV do Google Sheets.");

        try {
            const response = await fetch(url);
            const data = await response.text();
            const linhas = data.split('\n').slice(1);
            membros = linhas.map(l => {
                const col = l.split(',');
                return { 
                    nome: col[0]?.trim().replace(/"/g, ''), 
                    tel: col[1]?.trim().replace(/"/g, ''), 
                    p:0, f:0, nota: "" 
                };
            }).filter(m => m.nome && m.tel);

            salvar();
            alert("Ramo Juatuba: " + membros.length + " membros carregados com sucesso!");
        } catch (e) { 
            alert("Erro na sincroniza√ß√£o. Certifique-se que a planilha est√° 'Publicada na Web' como CSV."); 
        }
    }

    function adicionarNota(i) {
        const n = prompt("Nota de cuidado ou motivo de ora√ß√£o para " + membros[i].nome, membros[i].nota);
        if(n !== null) { membros[i].nota = n; salvar(); }
    }

    function abrirSugestoes(i, tipo) {
        const m = membros[i];
        const container = document.getElementById('opcoesMensagens');
        container.innerHTML = "";
        
        biblioteca[tipo].forEach(base => {
            let nTexto = m.nota ? `%0A%0AEstou em ora√ß√£o por: ${m.nota}. üôè` : "";
            let final = base.replace("{nome}", m.nome).replace("{nota}", nTexto);
            
            let card = document.createElement('div');
            card.className = 'sugestao-card';
            card.innerHTML = decodeURIComponent(final).replace(/\n/g, '<br>');
            card.onclick = () => {
                window.open(`https://wa.me/${m.tel}?text=${final}`, '_blank');
                fecharModal();
            };
            container.appendChild(card);
        });
        document.getElementById('modal').style.display = 'flex';
    }

    function fecharModal() { document.getElementById('modal').style.display = 'none'; }
    function salvar() { localStorage.setItem('membrosJuatuba', JSON.stringify(membros)); renderizar(); }

    function renderizar() {
        const lista = document.getElementById('listaMembros');
        if (membros.length === 0) {
            lista.innerHTML = "<p style='text-align:center; color:#999; padding: 20px;'>Sincronize a lista de membros para come√ßar o acompanhamento.</p>";
            return;
        }
        lista.innerHTML = "";
        membros.forEach((m, i) => {
            lista.innerHTML += `
                <div class="membro-item">
                    <div style="flex:1; cursor:pointer;" onclick="adicionarNota(${i})">
                        <span class="membro-nome">${m.nome}</span>
                        <span class="membro-nota">${m.nota ? 'üìù ' + m.nota : '+ adicionar nota'}</span>
                    </div>
                    <div style="display:flex; gap:10px;">
                        <button class="btn btn-p" onclick="abrirSugestoes(${i}, 'presenca')" title="Presen√ßa">P</button>
                        <button class="btn btn-f" onclick="abrirSugestoes(${i}, 'falta')" title="Falta">F</button>
                    </div>
                </div>`;
        });
    }
    renderizar();
</script>
</body>
</html>